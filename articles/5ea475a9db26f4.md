---
title: "【Rails】Google API を使ったスプレッドシートへのデータ書き込み方法を分かりやすく解説してみた"
emoji: "📑"
type: "tech"
topics: [ruby, rails, google, api, googlesheets]
published: false
publication_name: "linkedge"
---

## はじめに

Rails アプリケーションでは、データを CSV ファイルとして出力する機能が、一般的によく実装されます。
特に、レポート機能を備えたアプリケーションでは、CSV 形式でのデータ出力は欠かせません。

しかし、ダウンロードした CSV ファイルをそのまま使用するユーザーは少ないかもしれません。
実際には、以下のような流れで作業を進めるケースが多いでしょう。

1. アプリケーションから CSV ファイルをダウンロード
2. ダウンロードした CSV ファイルを開く
3. 必要なデータを CSV ファイルからコピーする
4. 関数を組み込んだ Excel ファイルにデータを貼り付ける
5. データをもとにグラフを作成したり、集計を行う

![](https://storage.googleapis.com/zenn-user-upload/7c00c87d3b45-20250308.png =400x)

この作業自体はそれほど時間がかかるものではありませんが、毎日繰り返すとなると手間になります。
しかし、アプリケーションにスプレッドシートへ直接データを書き込む機能を追加すれば、**ステップ 1 ~ 4 を省略でき、すぐにステップ 5 の作業に取り掛かれます。**

![](https://storage.googleapis.com/zenn-user-upload/9c493a53cb46-20250308.png =300x)

そこで本記事では、**Rails アプリケーションから Google API を使ってスプレッドシートへデータを書き込む方法**を分かりやすく解説します。

実装自体はそれほど難しくありませんが、手順が整理されている方がスムーズに進められるはずです。

同じような機能を実装したいと考えている方にとって、少しでも参考になれば幸いです。

ぜひ最後までご覧ください。

## 注意点

:::message alert
- 内容に誤りが含まれている可能性があります。
- コメント等でご指摘いただけますと幸いです。
:::

## 環境

本記事で使用する環境は以下の通りです。

:::message
使用環境
- **Docker Desktop**：4.39.0
- **Docker Engine**：28.0.1
- **Ruby**：3.3.5
- **Rails**：7.0.8.6
:::

## 前提

本記事で使用する Rails アプリケーションは、以下の構成を前提とします。

```ruby:db/schema.rb
ActiveRecord::Schema[7.0].define(version: 2024_12_21_083443) do
  create_table "posts", charset: "utf8mb4", collation: "utf8mb4_0900_ai_ci", force: :cascade do |t|
    t.bigint "user_id", null: false
    t.string "title", null: false
    t.text "content", null: false
    t.datetime "created_at", null: false
    t.datetime "updated_at", null: false
    t.index ["user_id"], name: "index_posts_on_user_id"
  end

  create_table "users", charset: "utf8mb4", collation: "utf8mb4_0900_ai_ci", force: :cascade do |t|
    t.string "name", null: false
    t.string "email", null: false
    t.integer "age", null: false
    t.string "login_id", null: false
    t.string "encrypted_password", null: false
    t.datetime "created_at", null: false
    t.datetime "updated_at", null: false
    t.index ["email"], name: "index_users_on_email", unique: true
    t.index ["login_id"], name: "index_users_on_login_id", unique: true
  end

  add_foreign_key "posts", "users"
end
```

```ruby:app/models/user.rb
class User < ApplicationRecord
  has_many :posts, dependent: :destroy
end
```

```ruby:app/models/post.rb
class Post < ApplicationRecord
  belongs_to :user
end
```

```ruby:app/controllers/posts_controller.rb
class PostsController < ApplicationController
  before_action :set_post, only: %i[show edit update destroy]

  def index
    @posts = current_user.posts.order(id: :desc)
  end

  def show; end

  def new
    @post = current_user.posts.new
  end

  def edit; end

  def create
    @post = current_user.posts.new(post_params)

    if @post.save
      redirect_to root_path, notice: 'Post was successfully created.'
    else
      render :new
    end
  end

  def update
    if @post.update(post_params)
      redirect_to root_path, notice: 'Post was successfully updated.'
    else
      render :edit
    end
  end

  def destroy
    @post.destroy
    redirect_to root_path, notice: 'Post was successfully destroyed.'
  end

  private

  def post_params
    params.require(:post).permit(:title, :content)
  end

  def set_post
    @post = current_user.posts.find(params[:id])
  end
end
```

![](https://storage.googleapis.com/zenn-user-upload/b181ff090174-20250308.png =1000x)
*投稿一覧画面*

この Rails アプリケーションは、一般的な構成になっています。
User と Post は 1 対多の関係で、基本的な CRUD 機能を備えています。
また、一覧画面にはログインユーザーが投稿した記事のみが表示されます。

## Google API について

まず、Google API について簡単に解説します。
Google API は、Google が提供するさまざまなサービスを利用できる API です。
例えば、「Maps JavaScript API」「Cloud Vision API」「Gmail API」など、多様な API が提供されています。

https://console.cloud.google.com/apis/library

Google API には、「Java」「Python」「PHP」など、さまざまなプログラミング言語向けのクライアントライブラリが提供されています。

https://developers.google.com/api-client-library

Ruby 向けのクライアントライブラリも提供されており、`google-api-client` という gem を使うことで、簡単に Google API を利用できます。

https://developers.google.com/sheets/api/guides/libraries#ruby

https://github.com/googleapis/google-api-ruby-client

https://rubygems.org/gems/google-api-client

---
title: "ã€Railsã€‘Google API ã‚’ä½¿ã£ãŸã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã¸ã®ãƒ‡ãƒ¼ã‚¿æ›¸ãè¾¼ã¿æ–¹æ³•ã‚’åˆ†ã‹ã‚Šã‚„ã™ãè§£èª¬ã—ã¦ã¿ãŸ"
emoji: "ğŸ“‘"
type: "tech"
topics: [ruby, rails, google, api, googlesheets]
published: false
publication_name: "linkedge"
---

## ã¯ã˜ã‚ã«

Rails ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã€ãƒ‡ãƒ¼ã‚¿ã‚’ CSV ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦å‡ºåŠ›ã™ã‚‹æ©Ÿèƒ½ãŒã€ä¸€èˆ¬çš„ã«ã‚ˆãå®Ÿè£…ã•ã‚Œã¾ã™ã€‚
ç‰¹ã«ã€ãƒ¬ãƒãƒ¼ãƒˆæ©Ÿèƒ½ã‚’å‚™ãˆãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã€CSV å½¢å¼ã§ã®ãƒ‡ãƒ¼ã‚¿å‡ºåŠ›ã¯æ¬ ã‹ã›ã¾ã›ã‚“ã€‚

ã—ã‹ã—ã€ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸ CSV ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãã®ã¾ã¾ä½¿ç”¨ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯å°‘ãªã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
å®Ÿéš›ã«ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãªæ‰‹é †ã§ä½œæ¥­ã‚’é€²ã‚ã‚‹ã“ã¨ãŒå¤šã„ã§ã—ã‚‡ã†ã€‚

1. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰ CSV ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
2. ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸ CSV ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã
3. å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ã‚’ CSV ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã‚³ãƒ”ãƒ¼ã™ã‚‹
4. é–¢æ•°ã‚’çµ„ã¿è¾¼ã‚“ã ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«ãƒ‡ãƒ¼ã‚¿ã‚’è²¼ã‚Šä»˜ã‘ã‚‹
5. ãƒ‡ãƒ¼ã‚¿ã‚’ã‚‚ã¨ã«ã‚°ãƒ©ãƒ•ã‚’ä½œæˆã—ãŸã‚Šã€é›†è¨ˆã‚’è¡Œã†

![](https://storage.googleapis.com/zenn-user-upload/f92e090798a7-20250309.png =400x)

ã“ã®ä½œæ¥­è‡ªä½“ã¯ãã‚Œã»ã©æ™‚é–“ãŒã‹ã‹ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€æ¯æ—¥ç¹°ã‚Šè¿”ã™ã¨ãªã‚‹ã¨æ‰‹é–“ã«ãªã‚Šã¾ã™ã€‚
ã—ã‹ã—ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã¸ç›´æ¥ãƒ‡ãƒ¼ã‚¿ã‚’æ›¸ãè¾¼ã‚€æ©Ÿèƒ½ã‚’è¿½åŠ ã™ã‚Œã°ã€**ã‚¹ãƒ†ãƒƒãƒ— 1 ~ 4 ã‚’çœç•¥ã§ãã€ã™ãã«ã‚¹ãƒ†ãƒƒãƒ— 5 ã®ä½œæ¥­ã«å–ã‚Šæ›ã‹ã‚Œã¾ã™ã€‚**

![](https://storage.googleapis.com/zenn-user-upload/9c493a53cb46-20250308.png =300x)

ãã“ã§æœ¬è¨˜äº‹ã§ã¯ã€**Rails ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰ Google API ã‚’ä½¿ã£ã¦ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã¸ãƒ‡ãƒ¼ã‚¿ã‚’æ›¸ãè¾¼ã‚€æ–¹æ³•**ã‚’åˆ†ã‹ã‚Šã‚„ã™ãè§£èª¬ã—ã¾ã™ã€‚

å®Ÿè£…è‡ªä½“ã¯ãã‚Œã»ã©é›£ã—ãã‚ã‚Šã¾ã›ã‚“ãŒã€æ‰‹é †ã‚’æ•´ç†ã—ã¦ãŠãã“ã¨ã§ã€ã‚¹ãƒ ãƒ¼ã‚ºã«é€²ã‚ã‚‰ã‚Œã‚‹ã¯ãšã§ã™ã€‚

åŒæ§˜ã®æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ãŸã„æ–¹ã«ã¨ã£ã¦ã€å°‘ã—ã§ã‚‚å‚è€ƒã«ãªã‚Œã°å¹¸ã„ã§ã™ã€‚

ãœã²æœ€å¾Œã¾ã§ã”è¦§ãã ã•ã„ã€‚

## æ³¨æ„ç‚¹

:::message alert
- å†…å®¹ã«èª¤ã‚ŠãŒå«ã¾ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
- ã‚³ãƒ¡ãƒ³ãƒˆãªã©ã§ã”æŒ‡æ‘˜ã„ãŸã ã‘ã‚‹ã¨å¹¸ã„ã§ã™ã€‚
:::

## ç’°å¢ƒ

æœ¬è¨˜äº‹ã§ä½¿ç”¨ã™ã‚‹ç’°å¢ƒã¯ä»¥ä¸‹ã®ã¨ãŠã‚Šã§ã™ã€‚

:::message
- **Docker Desktop**ï¼š4.39.0
- **Docker Engine**ï¼š28.0.1
- **Ruby**ï¼š3.3.5
- **Rails**ï¼š7.0.8.6
:::

## å‰æ

æœ¬è¨˜äº‹ã§ä½¿ç”¨ã™ã‚‹ Rails ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€ä»¥ä¸‹ã®æ§‹æˆã‚’å‰æã¨ã—ã¾ã™ã€‚

```ruby:db/schema.rb
ActiveRecord::Schema[7.0].define(version: 2024_12_21_083443) do
  create_table "posts", charset: "utf8mb4", collation: "utf8mb4_0900_ai_ci", force: :cascade do |t|
    t.bigint "user_id", null: false
    t.string "title", null: false
    t.text "content", null: false
    t.datetime "created_at", null: false
    t.datetime "updated_at", null: false
    t.index ["user_id"], name: "index_posts_on_user_id"
  end

  create_table "users", charset: "utf8mb4", collation: "utf8mb4_0900_ai_ci", force: :cascade do |t|
    t.string "name", null: false
    t.string "email", null: false
    t.integer "age", null: false
    t.string "login_id", null: false
    t.string "encrypted_password", null: false
    t.datetime "created_at", null: false
    t.datetime "updated_at", null: false
    t.index ["email"], name: "index_users_on_email", unique: true
    t.index ["login_id"], name: "index_users_on_login_id", unique: true
  end

  add_foreign_key "posts", "users"
end
```

```ruby:app/models/user.rb
class User < ApplicationRecord
  devise :database_authenticatable, authentication_keys: [:login_id]

  has_many :posts, dependent: :destroy
end
```

```ruby:app/models/post.rb
class Post < ApplicationRecord
  belongs_to :user
end
```

```ruby:app/controllers/posts_controller.rb
class PostsController < ApplicationController
  before_action :set_post, only: %i[show edit update destroy]

  def index
    @posts = current_user.posts.order(id: :desc)
  end

  def show; end

  def new
    @post = current_user.posts.new
  end

  def edit; end

  def create
    @post = current_user.posts.new(post_params)

    if @post.save
      redirect_to root_path, notice: 'Post was successfully created.'
    else
      render :new
    end
  end

  def update
    if @post.update(post_params)
      redirect_to root_path, notice: 'Post was successfully updated.'
    else
      render :edit
    end
  end

  def destroy
    @post.destroy
    redirect_to root_path, notice: 'Post was successfully destroyed.'
  end

  private

  def post_params
    params.require(:post).permit(:title, :content)
  end

  def set_post
    @post = current_user.posts.find(params[:id])
  end
end
```

```ruby:app/views/posts/index.html.slim
div.p-5
  h1.mb-3 æŠ•ç¨¿ä¸€è¦§
  p style="color: green" = notice
  = link_to "æ–°è¦è¿½åŠ ", new_post_path, class: 'btn btn-outline-info btn-sm m-3'
  .d-flex.flex-wrap.align-items-center
    - @posts.each do |post|
      .card.border.m-3 style="width: 400px;"
        .card-header.h5 = post.title
        .card-body
          .float-right
            button.copy-button.btn.btn-outline-secondary.btn-sm data-target="post_#{post.id}"
              i.far.fa-copy.mr-1
              span.copy-text ã‚³ãƒ”ãƒ¼
          div id="post_#{post.id}"
            .mb-3 = post.content
          = link_to "è©³ç´°", post, class: 'btn btn-outline-secondary btn-sm mr-1'
          = link_to "ç·¨é›†", edit_post_path(post), class: 'btn btn btn-outline-info btn-sm mr-1'
          = link_to "å‰Šé™¤", post, method: :delete, data: { turbo: "true", turbo_method: :delete, turbo_confirm: 'å‰Šé™¤ã—ã¾ã™ã‹?' }, class: "btn btn-outline-danger btn-sm"
```

```ruby:db/seeds.rb
10.times do |user_index|
  login_id = "login_id#{user_index + 1}"
  user = User.find_or_create_by(login_id: login_id) do |u|
    u.name = Faker::Name.name
    u.email = Faker::Internet.email
    u.age = rand(0..200)
    u.password = 'password'
    u.password_confirmation = 'password'
  end

  10.times do |post_index|
    Post.create!(
      user_id: user.id,
      title: "ãƒ¦ãƒ¼ã‚¶ãƒ¼#{user_index + 1}ã®æŠ•ç¨¿#{post_index + 1}ã®ã‚¿ã‚¤ãƒˆãƒ«",
      content: "ãƒ¦ãƒ¼ã‚¶ãƒ¼#{user_index + 1}ã®æŠ•ç¨¿#{post_index + 1}ã®å†…å®¹"
    )
  end
end
```

![](https://storage.googleapis.com/zenn-user-upload/74472c216e39-20250309.png =1000x)
*æŠ•ç¨¿ä¸€è¦§ç”»é¢*

ã“ã® Rails ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€User ã¨ Post ãŒ 1 å¯¾å¤šã®é–¢ä¿‚ã«ã‚ã‚Šã€åŸºæœ¬çš„ãª CRUD æ©Ÿèƒ½ã‚’å‚™ãˆãŸä¸€èˆ¬çš„ãªæ§‹æˆã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚
ã¾ãŸã€ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ã¯ [devise](https://github.com/heartcombo/devise) ã‚’ä½¿ç”¨ã—ã¦å®Ÿè£…ã—ã¦ãŠã‚Šã€æŠ•ç¨¿ä¸€è¦§ç”»é¢ã«ã¯ã€ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæŠ•ç¨¿ã—ãŸè¨˜äº‹ã®ã¿ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

## Google API ã«ã¤ã„ã¦

ã¾ãšã€Google API ã«ã¤ã„ã¦ç°¡å˜ã«è§£èª¬ã—ã¾ã™ã€‚
Google API ã¯ã€Google ãŒæä¾›ã™ã‚‹ã•ã¾ã–ã¾ãªã‚µãƒ¼ãƒ“ã‚¹ã‚’ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‹ã‚‰åˆ©ç”¨ã§ãã‚‹ API ã§ã™ã€‚
ä¾‹ãˆã°ã€ã€ŒMaps JavaScript APIã€ã€ŒCloud Vision APIã€ã€ŒGmail APIã€ãªã©ã€ã•ã¾ã–ã¾ãª API ãŒæä¾›ã•ã‚Œã¦ã„ã¾ã™ã€‚

https://console.cloud.google.com/apis/library

Google API ã«ã¯ã€ã€ŒJavaã€ã€ŒPythonã€ã€ŒPHPã€ãªã©ã€ã•ã¾ã–ã¾ãªãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªå‘ã‘ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒæä¾›ã•ã‚Œã¦ã„ã¾ã™ã€‚

https://developers.google.com/api-client-library

Ruby å‘ã‘ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚‚æä¾›ã•ã‚Œã¦ãŠã‚Šã€[google-api-client](https://github.com/googleapis/google-api-ruby-client) ã¨ã„ã† gem ã‚’ä½¿ã†ã“ã¨ã§ã€ç°¡å˜ã« Google API ã‚’åˆ©ç”¨ã§ãã¾ã™ã€‚

## å®Ÿè£…

:::message alert
- æœ¬è¨˜äº‹ã‚’ä½œæˆã™ã‚‹ã«ã‚ãŸã£ã¦ä½œæˆã—ãŸèªè¨¼æƒ…å ±ã‚„ãƒ•ã‚©ãƒ«ãƒ€ã€ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã¯ã€è¨˜äº‹ä½œæˆæ™‚ç‚¹ã§å‰Šé™¤ã—ã¦ã„ã¾ã™ã€‚
- ãã®ãŸã‚ã€æœ¬è¨˜äº‹ã§ã¯ã€èªè¨¼æƒ…å ±ã‚„ ID ãªã©ã‚’ç‰¹ã«éš ã—ã¦ã„ã¾ã›ã‚“ã€‚
- å®Ÿéš›ã«å®Ÿè£…ã™ã‚‹éš›ã¯ã€èªè¨¼æƒ…å ±ã‚„ ID ãªã©ã‚’é©åˆ‡ã«ç®¡ç†ã—ã¦ãã ã•ã„ã€‚
:::

### 1. User ãƒ†ãƒ¼ãƒ–ãƒ«ã«ã‚«ãƒ©ãƒ ã‚’è¿½åŠ 

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã«ç•°ãªã‚‹ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«ãƒ‡ãƒ¼ã‚¿ã‚’æ›¸ãè¾¼ã‚€ãŸã‚ã€User ãƒ†ãƒ¼ãƒ–ãƒ«ã«ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆ ID ã‚’ä¿å­˜ã™ã‚‹ã‚«ãƒ©ãƒ ã‚’è¿½åŠ ã—ã¾ã™ã€‚
ã“ã®ã‚«ãƒ©ãƒ ã‚’åˆ©ç”¨ã—ã¦ã€å„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’ç®¡ç†ã—ã¾ã™ã€‚

```ruby:ã‚¿ãƒ¼ãƒŸãƒŠãƒ«
docker compose exec app rails g migration AddSpreadsheetIdToUsers spreadsheet_id:string
```

```ruby:db/migrate/20250308134258_add_spreadsheet_id_to_users.rb
class AddSpreadsheetIdToUsers < ActiveRecord::Migration[7.0]
  def change
    add_column :users, :spreadsheet_id, :string
  end
end
```

```ruby:ã‚¿ãƒ¼ãƒŸãƒŠãƒ«
docker compose exec app rails db:migrate
```

```diff ruby:db/schema.rb
ActiveRecord::Schema[7.0].define(version: 2025_03_08_134258) do
  create_table "posts", charset: "utf8mb4", collation: "utf8mb4_0900_ai_ci", force: :cascade do |t|
    t.bigint "user_id", null: false
    t.string "title", null: false
    t.text "content", null: false
    t.datetime "created_at", null: false
    t.datetime "updated_at", null: false
    t.index ["user_id"], name: "index_posts_on_user_id"
  end

  create_table "users", charset: "utf8mb4", collation: "utf8mb4_0900_ai_ci", force: :cascade do |t|
    t.string "name", null: false
    t.string "email", null: false
    t.integer "age", null: false
    t.string "login_id", null: false
    t.string "encrypted_password", null: false
    t.datetime "created_at", null: false
    t.datetime "updated_at", null: false
+   t.string "spreadsheet_id"
    t.index ["email"], name: "index_users_on_email", unique: true
    t.index ["login_id"], name: "index_users_on_login_id", unique: true
  end

  add_foreign_key "posts", "users"
end
```

### 2. Google API ç”¨ã®èªè¨¼æƒ…å ±ã‚’å–å¾—

ä»Šå›ã®å®Ÿè£…ã§ã¯ã€Google Cloud ã‹ã‚‰ä»¥ä¸‹ã® 3 ã¤ã®èªè¨¼æƒ…å ±ã‚’å–å¾—ã—ã¾ã™ã€‚

- project_id
- private_key
- client_email

#### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ

ã¾ãšã€[Google Cloud](https://console.cloud.google.com/welcome) ã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/b6c062363a78-20250309.jpeg =1000x)
*ã€Œãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®é¸æŠã€ã‚’ã‚¯ãƒªãƒƒã‚¯*

![](https://storage.googleapis.com/zenn-user-upload/cd747f4c2559-20250309.jpeg =1000x)
*ã€Œæ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯*

![](https://storage.googleapis.com/zenn-user-upload/74f7364a5c29-20250309.jpeg =1000x)
*ã€Œãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã€ã‚’å…¥åŠ›ã—ã€ã€Œä½œæˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯*

#### ã‚µãƒ¼ãƒ“ã‚¹ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ä½œæˆ

![](https://storage.googleapis.com/zenn-user-upload/16de5fb39d7a-20250309.jpeg =1000x)
*ã€Œãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®é¸æŠã€ã‚’ã‚¯ãƒªãƒƒã‚¯*

![](https://storage.googleapis.com/zenn-user-upload/ecd616e3433c-20250309.jpeg =1000x)
*å…ˆã»ã©ä½œæˆã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚¯ãƒªãƒƒã‚¯*

![](https://storage.googleapis.com/zenn-user-upload/2cab0551382a-20250309.jpeg =1000x)
*ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‹ã‚‰ã€ŒAPI ã¨ã‚µãƒ¼ãƒ“ã‚¹ã€ > ã€Œèªè¨¼æƒ…å ±ã€ã‚’ã‚¯ãƒªãƒƒã‚¯*

![](https://storage.googleapis.com/zenn-user-upload/86235fe9d6b2-20250309.jpeg =1000x)
*ã€Œã‚µãƒ¼ãƒ“ã‚¹ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ç®¡ç†ã€ã‚’ã‚¯ãƒªãƒƒã‚¯*

![](https://storage.googleapis.com/zenn-user-upload/60d9f71ba6ef-20250309.jpeg =1000x)
*ã€Œã‚µãƒ¼ãƒ“ã‚¹ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯*

![](https://storage.googleapis.com/zenn-user-upload/73324e04650a-20250309.jpeg =1000x)
*ã€Œã‚µãƒ¼ãƒ“ã‚¹ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ IDã€ã‚’å…¥åŠ›ã—ã€ã€Œä½œæˆã—ã¦ç¶šè¡Œã€ã‚’ã‚¯ãƒªãƒƒã‚¯*

![](https://storage.googleapis.com/zenn-user-upload/1c7d3da2eec2-20250309.jpeg =1000x)
*ã€Œãƒ­ãƒ¼ãƒ«ã‚’é¸æŠã€ > ã€ŒåŸºæœ¬ã€ > ã€Œç·¨é›†è€…ã€ã‚’ã‚¯ãƒªãƒƒã‚¯*

![](https://storage.googleapis.com/zenn-user-upload/c6561ac24e0a-20250309.jpeg =1000x)
*ã€Œå®Œäº†ã€ã‚’ã‚¯ãƒªãƒƒã‚¯*

#### éµã®ä½œæˆ

![](https://storage.googleapis.com/zenn-user-upload/499b7d893cfd-20250309.jpeg =1000x)
*ã€Œéµã‚’ç®¡ç†ã€ã‚’ã‚¯ãƒªãƒƒã‚¯*

![](https://storage.googleapis.com/zenn-user-upload/10e11381e691-20250309.jpeg =1000x)
*ã€Œæ–°ã—ã„éµã‚’ä½œæˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯*

![](https://storage.googleapis.com/zenn-user-upload/490f6bddd186-20250309.jpeg =1000x)
*ã€ŒJSONã€ã‚’é¸æŠã—ã€ã€Œä½œæˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯*

JSON ãƒ•ã‚¡ã‚¤ãƒ«ãŒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸã‚‰ã€èªè¨¼æƒ…å ±ã®å–å¾—ã¯å®Œäº†ã§ã™ã€‚

```json:test-app-453114-d0a87e196a1c.json
{
  "type": "service_account",
  "project_id": "test-app-453114",
  "private_key_id": "d0a87e196a1c1b65760673a361d81bc10c9239e4",
  "private_key": "-----BEGIN PRIVATE KEY-----\nMIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQC3XyVLGqGBsKZu\n1z2Kq/UYmH/iOPnYrkhjKOSaD0evnI9XDQNTOKuTGoGN2NwdQNYQXbQfGXYv9doJ\nkf4uQSrhjVsB/zA/KlsUQCczxaiG4f1zooSeqw+35lUayiAHDUI7GoJLjceMuKtS\nvytFuQct3BVuXFzOBnqidXmkSQw1u1WNRRpn6qAmF91vnv2+pMUPavm2sYA+At1o\nBMxAO0EFryGzUkYzgvP4KP5MUvxgqj45UuSPTikSbP/NhNcJoLpnBXMkD5tLmX7L\nvxogF2Sgnat4DA664Dnc2uLdYc6+O6GCht71SeLzTiyv9uz0L7u2rnQMbvPfiEDh\noOSrt+STAgMBAAECggEAIIcqvOdk9fYJmAjrfFFjoXDP4qfbvjGwWpKy9pc2TrMV\nhEolKFqZqPcfOzPYXAIX1wBgRtID8p8IhgEVV0wtGKS0G6cSfmn7jRySN69c5Uxq\nYtxV7TWIDMW5nA513vpdoNFjgpaMauyJS5zoxq37VYnAbXrJ5awljfML2HYyycb7\nBjIsyHiBVFvp3u+mr/PHscnH784Wr6ksxvOqTur1JRc8nd5EJe1U7SuN+/7H+o6f\nLf4yl09kvEqDCk+raXEtg/qRDpz3A9L5Ba1YLH8vKy64oJqjYNThxXrPvw2dYDB1\ncgbBbbJLjMs4yT4R+1+HGid+lNgrRK3lxDpxH0zd6QKBgQD/+Gwdm6LMr8I9ln+q\nwEbJh7P944VQ17oS1ucGqTgy33/lCfrwxKLMM+CizzNJq3rCcILO9Gw4MRWpaCso\n3DkgghOg13RcurNRgUsieJM0PC36aV8Ohx6n4ixsT8jX3uoyod/EuBqgndvbBUgA\nR0h1fuKfSg8f5ES4RLugWSUCiwKBgQC3ZJL8Dpx0lvPb7GxC5PHySn+H7cXbFp31\nB90JY60YvW9xwDCnfQvY7A1cY/hybu06voKJgpJ9YNtVGb/GFte4Qdj4cianWwEL\nnjuvpo/EqODs72D0A7OYji8ziVnBgoQfGO7QPW7TuPk3FrVT2p4tdnyS693WlVDj\n6xjU0O2PGQKBgBwYDv287ERc8gvCbea2zc4mt8mg5Cv4UXLp5Vdk0Uc8IpRn4QP2\nAQw6kWgtJ6rpSEL5CFJgn1QXhxId3cbRTO/VdwQLQbk/wJisgSuaYkW0aTN3xzgX\n+nRgrZGBvEB9NeUywRWdQ0bnrI7AaKOnLzu+Hm9vOHO+oRA8cv9paVd7AoGBAKt+\nlGi6rRnl01K0KqT/fTUq70lIUz5GTx3E5bETEdpRw3Zm19i3+a03SGM+ZSV1j8fg\nQSef/6bZPSG+e3QdBksa4G+sJ3NWiYq4xG3EXyrzFarbSxnEoFynkYIrDdEEYNLH\nuQLof8vjbMFULeqlREeVRncJtCAm70bDISxZ19x5AoGBAO2p1ZaOkHPQk9w+rdhZ\n/ONtWCISxicywra6nykGCIUs20wepDch9ZiyF+fNb3+RPZJ7iqVjNX2rZnL6k9Kp\nREbqCbWzcLkf+jiYsR9Qv3Wx1LsqK48RJ3R/5w6K48wGHMxDSUiewU6zPAVYRg9x\njta9DNOLFBGehtzEYaYYvbOx\n-----END PRIVATE KEY-----\n",
  "client_email": "test-app@test-app-453114.iam.gserviceaccount.com",
  "client_id": "103380005679277192011",
  "auth_uri": "https://accounts.google.com/o/oauth2/auth",
  "token_uri": "https://oauth2.googleapis.com/token",
  "auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs",
  "client_x509_cert_url": "https://www.googleapis.com/robot/v1/metadata/x509/test-app%40test-app-453114.iam.gserviceaccount.com",
  "universe_domain": "googleapis.com"
}
```

### 3. Google API ã®æœ‰åŠ¹åŒ–

ä»Šå›ã®å®Ÿè£…ã§ã¯ã€ä»¥ä¸‹ã® 2 ã¤ã® API ã‚’æœ‰åŠ¹åŒ–ã—ã¾ã™ã€‚
- [Google Drive API](https://developers.google.com/drive/api/reference/rest/v3)
- [Google Sheets API](https://developers.google.com/sheets/api/reference/rest)

![](https://storage.googleapis.com/zenn-user-upload/c974b4ec2bb0-20250309.jpeg =1000x)
*ã€ŒAPI ã¨ã‚µãƒ¼ãƒ“ã‚¹ã€ > ã€Œãƒ©ã‚¤ãƒ–ãƒ©ãƒªã€ã‚’ã‚¯ãƒªãƒƒã‚¯*

![](https://storage.googleapis.com/zenn-user-upload/872f465be615-20250309.jpeg =1000x)
*æ¤œç´¢çª“ã«ã€Œdriveã€ã¨å…¥åŠ›ã—ã€ã€ŒGoogle Drive APIã€ã‚’ã‚¯ãƒªãƒƒã‚¯*

![](https://storage.googleapis.com/zenn-user-upload/5c74e7c73844-20250309.jpeg =1000x)
*ã€Œæœ‰åŠ¹ã«ã™ã‚‹ã€ã‚’ã‚¯ãƒªãƒƒã‚¯*

![](https://storage.googleapis.com/zenn-user-upload/04aaf03bae79-20250309.jpeg =1000x)
*æ¤œç´¢çª“ã«ã€Œsheetã€ã¨å…¥åŠ›ã—ã€ã€ŒGoogle Sheets APIã€ã‚’ã‚¯ãƒªãƒƒã‚¯*

![](https://storage.googleapis.com/zenn-user-upload/44305b81903a-20250309.jpeg =1000x)
*ã€Œæœ‰åŠ¹ã«ã™ã‚‹ã€ã‚’ã‚¯ãƒªãƒƒã‚¯*

### 4. Google Drive ã§ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆ

ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’ä¿å­˜ã™ã‚‹ãŸã‚ã«ã€æ–°ã—ã„ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆã—ã¾ã™ã€‚

[ãƒã‚¤ãƒ‰ãƒ©ã‚¤ãƒ–](https://drive.google.com/drive/u/0/my-drive) ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/46d434f1b042-20250309.jpeg =1000x)
*ã€Œæ–°è¦ã€ã‚’ã‚¯ãƒªãƒƒã‚¯*

![](https://storage.googleapis.com/zenn-user-upload/a6f52d5538f7-20250309.jpeg =1000x)
*ã€Œæ–°ã—ã„ãƒ•ã‚©ãƒ«ãƒ€ã€ã‚’ã‚¯ãƒªãƒƒã‚¯*

![](https://storage.googleapis.com/zenn-user-upload/57684b169563-20250309.jpeg =1000x)
*ãƒ•ã‚©ãƒ«ãƒ€åã‚’å…¥åŠ›ã—ã€ã€Œä½œæˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯*

![](https://storage.googleapis.com/zenn-user-upload/3f7b209ba565-20250309.jpeg =1000x)
*ä½œæˆã—ãŸãƒ•ã‚©ãƒ«ãƒ€ã‚’å³ã‚¯ãƒªãƒƒã‚¯ã—ã€ã€Œå…±æœ‰ã€ã‚’ã‚¯ãƒªãƒƒã‚¯*

![](https://storage.googleapis.com/zenn-user-upload/b8014cd07ccf-20250309.jpeg =1000x)
*å…ˆã»ã©ã® JSON ãƒ•ã‚¡ã‚¤ãƒ«ã® client_email ã‚’å…¥åŠ›ã—ã€ã€Œç·¨é›†è€…ã€ã‚’é¸æŠã—ã€ã€Œé€ä¿¡ã€ã‚’ã‚¯ãƒªãƒƒã‚¯*

![](https://storage.googleapis.com/zenn-user-upload/35d86a261557-20250309.jpeg =1000x)
*ä½œæˆã—ãŸãƒ•ã‚©ãƒ«ãƒ€ã‚’é–‹ãã€URL ã«å«ã¾ã‚Œã‚‹ãƒ•ã‚©ãƒ«ãƒ€ ID ã‚’å–å¾—*

### 5. ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

ä»Šå›ã®å®Ÿè£…ã§ã¯ã€ç’°å¢ƒå¤‰æ•°ã®ç®¡ç†ã« [dotenv](https://github.com/bkeepers/dotenv) ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

dotenv ã¯ã€`.env` ãƒ•ã‚¡ã‚¤ãƒ«ã«ç’°å¢ƒå¤‰æ•°ã‚’è¨˜è¿°ã—ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å†…ã§ä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ gem ã§ã™ã€‚

dotenv ã®å°å…¥æ‰‹é †ã«ã¤ã„ã¦ã¯æœ¬è¨˜äº‹ã§ã¯å‰²æ„›ã—ã¾ã™ã€‚

```ruby:.env
GOOGLE_DRIVE_FOLDER_ID="1V5pZzCw1kESCy4Ia402qy3VvhEu9hVJO"
GOOGLE_PROJECT_ID="test-app-453114"
GOOGLE_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\nMIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQC3XyVLGqGBsKZu\n1z2Kq/UYmH/iOPnYrkhjKOSaD0evnI9XDQNTOKuTGoGN2NwdQNYQXbQfGXYv9doJ\nkf4uQSrhjVsB/zA/KlsUQCczxaiG4f1zooSeqw+35lUayiAHDUI7GoJLjceMuKtS\nvytFuQct3BVuXFzOBnqidXmkSQw1u1WNRRpn6qAmF91vnv2+pMUPavm2sYA+At1o\nBMxAO0EFryGzUkYzgvP4KP5MUvxgqj45UuSPTikSbP/NhNcJoLpnBXMkD5tLmX7L\nvxogF2Sgnat4DA664Dnc2uLdYc6+O6GCht71SeLzTiyv9uz0L7u2rnQMbvPfiEDh\noOSrt+STAgMBAAECggEAIIcqvOdk9fYJmAjrfFFjoXDP4qfbvjGwWpKy9pc2TrMV\nhEolKFqZqPcfOzPYXAIX1wBgRtID8p8IhgEVV0wtGKS0G6cSfmn7jRySN69c5Uxq\nYtxV7TWIDMW5nA513vpdoNFjgpaMauyJS5zoxq37VYnAbXrJ5awljfML2HYyycb7\nBjIsyHiBVFvp3u+mr/PHscnH784Wr6ksxvOqTur1JRc8nd5EJe1U7SuN+/7H+o6f\nLf4yl09kvEqDCk+raXEtg/qRDpz3A9L5Ba1YLH8vKy64oJqjYNThxXrPvw2dYDB1\ncgbBbbJLjMs4yT4R+1+HGid+lNgrRK3lxDpxH0zd6QKBgQD/+Gwdm6LMr8I9ln+q\nwEbJh7P944VQ17oS1ucGqTgy33/lCfrwxKLMM+CizzNJq3rCcILO9Gw4MRWpaCso\n3DkgghOg13RcurNRgUsieJM0PC36aV8Ohx6n4ixsT8jX3uoyod/EuBqgndvbBUgA\nR0h1fuKfSg8f5ES4RLugWSUCiwKBgQC3ZJL8Dpx0lvPb7GxC5PHySn+H7cXbFp31\nB90JY60YvW9xwDCnfQvY7A1cY/hybu06voKJgpJ9YNtVGb/GFte4Qdj4cianWwEL\nnjuvpo/EqODs72D0A7OYji8ziVnBgoQfGO7QPW7TuPk3FrVT2p4tdnyS693WlVDj\n6xjU0O2PGQKBgBwYDv287ERc8gvCbea2zc4mt8mg5Cv4UXLp5Vdk0Uc8IpRn4QP2\nAQw6kWgtJ6rpSEL5CFJgn1QXhxId3cbRTO/VdwQLQbk/wJisgSuaYkW0aTN3xzgX\n+nRgrZGBvEB9NeUywRWdQ0bnrI7AaKOnLzu+Hm9vOHO+oRA8cv9paVd7AoGBAKt+\nlGi6rRnl01K0KqT/fTUq70lIUz5GTx3E5bETEdpRw3Zm19i3+a03SGM+ZSV1j8fg\nQSef/6bZPSG+e3QdBksa4G+sJ3NWiYq4xG3EXyrzFarbSxnEoFynkYIrDdEEYNLH\nuQLof8vjbMFULeqlREeVRncJtCAm70bDISxZ19x5AoGBAO2p1ZaOkHPQk9w+rdhZ\n/ONtWCISxicywra6nykGCIUs20wepDch9ZiyF+fNb3+RPZJ7iqVjNX2rZnL6k9Kp\nREbqCbWzcLkf+jiYsR9Qv3Wx1LsqK48RJ3R/5w6K48wGHMxDSUiewU6zPAVYRg9x\njta9DNOLFBGehtzEYaYYvbOx\n-----END PRIVATE KEY-----\n"
GOOGLE_CLIENT_EMAIL="test-app@test-app-453114.iam.gserviceaccount.com"
```

### 6. gem ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```diff ruby:Gemfile
+ gem 'google-api-client'
```

```ruby:ã‚¿ãƒ¼ãƒŸãƒŠãƒ«
docker compose exec app bundle install
```

### 7. SpreadsheetService ã®ä½œæˆ

ã§ã¯ã€å®Ÿéš›ã« Google API ã‚’ä½¿ã£ãŸã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®ä½œæˆã¨ãƒ‡ãƒ¼ã‚¿ã®æ›¸ãè¾¼ã¿ã‚’è¡Œã†å‡¦ç†ã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã™ã€‚

```ruby:app/services/spreadsheet_service.rb
require 'google/apis/drive_v3'
require 'google/apis/sheets_v4'
require 'googleauth'

class SpreadsheetService
  SCOPE = [
    Google::Apis::DriveV3::AUTH_DRIVE,
    Google::Apis::SheetsV4::AUTH_SPREADSHEETS
  ].freeze

  def initialize
    @sheets_service = Google::Apis::SheetsV4::SheetsService.new
    @drive_service = Google::Apis::DriveV3::DriveService.new

    @sheets_service.client_options.application_name = 'test-app'
    @drive_service.client_options.application_name = 'test-app'

    credentials = authorize
    @sheets_service.authorization = credentials
    @drive_service.authorization = credentials
  end

  def create_spreadsheet(user)
    google_drive_folder_id = ENV.fetch('GOOGLE_DRIVE_FOLDER_ID', nil)
    spreadsheet_name = "Post - #{user.name}"
    request = Google::Apis::DriveV3::File.new(
      name: spreadsheet_name,
      parents: [google_drive_folder_id],
      mime_type: 'application/vnd.google-apps.spreadsheet'
    )
    spreadsheet = @drive_service.create_file(request)
    user.update!(spreadsheet_id: spreadsheet.id)
  end

  def export_posts(user)
    spreadsheet_id = user.spreadsheet_id
    sheet_name = 'Sheet1'
    range = "#{sheet_name}!A1:E"
    @sheets_service.clear_values(spreadsheet_id, range)
    values = [['ID', 'Title', 'Content', 'Created At', 'Updated At']]
    user.posts.order(id: :desc).each do |post|
      values << [post.id, post.title, post.content, post.created_at.strftime('%Y-%m-%d %H:%M:%S'),
                 post.updated_at.strftime('%Y-%m-%d %H:%M:%S')]
    end
    value_range_object = Google::Apis::SheetsV4::ValueRange.new(values: values)
    @sheets_service.update_spreadsheet_value(
      spreadsheet_id,
      range,
      value_range_object,
      value_input_option: 'RAW'
    )
  end

  private

  def authorize
    Google::Auth::ServiceAccountCredentials.make_creds(
      json_key_io: StringIO.new(service_account_json),
      scope: SCOPE
    )
  end

  def service_account_json
    {
      type: 'service_account',
      project_id: ENV.fetch('GOOGLE_PROJECT_ID', nil),
      private_key_id: '',
      private_key: ENV.fetch('GOOGLE_PRIVATE_KEY', nil).gsub('\\n', "\n"),
      client_email: ENV.fetch('GOOGLE_CLIENT_EMAIL', nil),
      client_id: '',
      auth_uri: 'https://accounts.google.com/o/oauth2/auth',
      token_uri: 'https://oauth2.googleapis.com/token',
      auth_provider_x509_cert_url: 'https://www.googleapis.com/oauth2/v1/certs',
      client_x509_cert_url: ''
    }.to_json
  end
end
```

### 8. PostsController ã®ä¿®æ­£

```diff ruby:app/controllers/posts_controller.rb
class PostsController < ApplicationController
  before_action :set_post, only: %i[show edit update destroy]

  def index
    @posts = current_user.posts.order(id: :desc)
  end

  def show; end

  def new
    @post = current_user.posts.new
  end

  def edit; end

  def create
    @post = current_user.posts.new(post_params)

    if @post.save
      redirect_to root_path, notice: 'Post was successfully created.'
    else
      render :new
    end
  end

  def update
    if @post.update(post_params)
      redirect_to root_path, notice: 'Post was successfully updated.'
    else
      render :edit
    end
  end

  def destroy
    @post.destroy
    redirect_to root_path, notice: 'Post was successfully destroyed.'
  end

+ def export_to_spreadsheet
+   spreadsheet_service = SpreadsheetService.new
+   spreadsheet_service.create_spreadsheet(current_user) if current_user.spreadsheet_id.blank?
+   spreadsheet_service.export_posts(current_user)
+   redirect_to root_path, notice: 'Post was successfully exported to Spreadsheet.'
+ end

  private

  def post_params
    params.require(:post).permit(:title, :content)
  end

  def set_post
    @post = current_user.posts.find(params[:id])
  end
end
```

### 9. ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®ä¿®æ­£

```diff ruby:config/routes.rb
Rails.application.routes.draw do
  root to: 'posts#index'

  devise_for :users, controllers: {
    sessions: 'sessions'
  }, path: '', path_names: { sign_in: 'sign_in', sign_out: 'sign_out' }

+ resources :posts, only: %i[show new create edit update destroy] do
+   collection do
+     get :export_to_spreadsheet
+   end
+ end
end
```

### 10. æŠ•ç¨¿ä¸€è¦§ç”»é¢ã®ä¿®æ­£

```diff ruby:app/views/posts/index.html.slim
div.p-5
  h1.mb-3 æŠ•ç¨¿ä¸€è¦§
  p style="color: green" = notice
  = link_to "æ–°è¦è¿½åŠ ", new_post_path, class: 'btn btn-outline-info btn-sm m-3'
+ = link_to "ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«å‡ºåŠ›", export_to_spreadsheet_posts_path, class: 'btn btn-outline-primary btn-sm'
  .d-flex.flex-wrap.align-items-center
    - @posts.each do |post|
      .card.border.m-3 style="width: 400px;"
        .card-header.h5 = post.title
        .card-body
          .float-right
            button.copy-button.btn.btn-outline-secondary.btn-sm data-target="post_#{post.id}"
              i.far.fa-copy.mr-1
              span.copy-text ã‚³ãƒ”ãƒ¼
          div id="post_#{post.id}"
            .mb-3 = post.content
          = link_to "è©³ç´°", post, class: 'btn btn-outline-secondary btn-sm mr-1'
          = link_to "ç·¨é›†", edit_post_path(post), class: 'btn btn btn-outline-info btn-sm mr-1'
          = link_to "å‰Šé™¤", post, method: :delete, data: { turbo: "true", turbo_method: :delete, turbo_confirm: 'å‰Šé™¤ã—ã¾ã™ã‹?' }, class: "btn btn-outline-danger btn-sm"
```

ä»¥ä¸Šã§å®Ÿè£…ã¯å®Œäº†ã§ã™ã€‚

## å‹•ä½œç¢ºèª

å®Ÿè£…ãŒå®Œäº†ã—ãŸã®ã§ã€å®Ÿéš›ã«å‹•ä½œç¢ºèªã‚’è¡Œã£ã¦ã¿ã¾ã™ã€‚

### 1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ã®ç¢ºèª

ã¾ãšã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèªã—ã¾ã™ã€‚

```ruby:ã‚¿ãƒ¼ãƒŸãƒŠãƒ«
docker compose exec app rails c
Loading development environment (Rails 7.0.8.6)
irb(main):001> user = User.find(1)
  User Load (0.3ms)  SELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1 /*application:TestApp*/
=> #<User id: 1, name: "Bruce Windler", email: "gerri@kuhn.test", age: 140, login_id: "login_id1", created_at: "2025-0...
irb(main):002> user
=> #<User id: 1, name: "Bruce Windler", email: "gerri@kuhn.test", age: 140, login_id: "login_id1", created_at: "2025-03-09 10:28:37.892400000 +0900", updated_at: "2025-03-09 10:28:37.892400000 +0900", spreadsheet_id: nil>
```

åå‰ãŒ Bruce Windler ã§ã€ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆ ID ãŒ nil ã§ã‚ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚

### 2. Google Drive ã®ç¢ºèª


æ¬¡ã«ã€Google Drive ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€ãƒ•ã‚©ãƒ«ãƒ€å†…ã‚’ç¢ºèªã—ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/ba14220a3aa1-20250309.png =1000x)

ãƒ•ã‚©ãƒ«ãƒ€å†…ã«ã¯ä½•ã‚‚ãªã„ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚

### 3. ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«å‡ºåŠ›

æŠ•ç¨¿ä¸€è¦§ç”»é¢ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€ã€Œã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«å‡ºåŠ›ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/28c46e7acf10-20250309.jpeg =1000x)

![](https://storage.googleapis.com/zenn-user-upload/e7cd9380c4e0-20250309.png =1000x)

ã€ŒPost was successfully exported to Spreadsheet.ã€ã¨è¡¨ç¤ºã•ã‚ŒãŸã®ã§ã€ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«ãƒ‡ãƒ¼ã‚¿ãŒæ›¸ãè¾¼ã¾ã‚ŒãŸã¿ãŸã„ã§ã™ã€‚

### 4. ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®ç¢ºèª

å…ˆã»ã©ã¾ã§ãƒ•ã‚©ãƒ«ãƒ€å†…ã¯ç©ºã§ã—ãŸãŒã€ç¾åœ¨ã¯ã€ã€ŒPost - Bruce Windlerã€ã¨ã„ã†ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/66727e4f047a-20250309.png =1000x)

ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’é–‹ã„ã¦ã¿ã‚‹ã¨ã€ãƒ‡ãƒ¼ã‚¿ãŒæ›¸ãè¾¼ã¾ã‚Œã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/a30e48607b7d-20250309.png =1000x)

### 5. ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆ ID ã®ç¢ºèª

ä½œæˆã—ãŸã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã® ID ã‚’ç¢ºèªã—ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/987e8c77d5ef-20250309.jpeg =1000x)

ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã® URL ã‹ã‚‰ã€ã“ã®ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã® ID ãŒã€Œ1V0y760KHWYvvaVRqadXDzWchSnJ0Kdb65W6HuQXjkwEã€ã§ã‚ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚

ã§ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```ruby:ã‚¿ãƒ¼ãƒŸãƒŠãƒ«
docker compose exec app rails c
Loading development environment (Rails 7.0.8.6)
irb(main):001> user = User.find(1)
  User Load (0.6ms)  SELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1 /*application:TestApp*/
=> #<User id: 1, name: "Bruce Windler", email: "gerri@kuhn.test", age: 140, login_id: "login_id1", created_at: "2025-0...
irb(main):002> user
=> #<User id: 1, name: "Bruce Windler", email: "gerri@kuhn.test", age: 140, login_id: "login_id1", created_at: "2025-03-09 10:28:37.892400000 +0900", updated_at: "2025-03-09 10:34:35.618204000 +0900", spreadsheet_id: "1V0y760KHWYvvaVRqadXDzWchSnJ0Kdb65W6HuQXjkwE">
```

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆ ID ãŒã€Œ1V0y760KHWYvvaVRqadXDzWchSnJ0Kdb65W6HuQXjkwEã€ã«æ›´æ–°ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚

å‹•ä½œç¢ºèªã¯ä»¥ä¸Šã§ã™ã€‚

## ãŠã‚ã‚Šã«

ã„ã‹ãŒã§ã—ãŸã§ã—ã‚‡ã†ã‹ï¼Ÿ

ä»Šå›ã¯ã€**Rails ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰ Google API ã‚’ä½¿ã£ã¦ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã¸ãƒ‡ãƒ¼ã‚¿ã‚’æ›¸ãè¾¼ã‚€æ–¹æ³•**ã«ã¤ã„ã¦è§£èª¬ã—ã¾ã—ãŸã€‚

ã“ã®æ©Ÿèƒ½ã‚’ã•ã‚‰ã«ä¾¿åˆ©ã«ã™ã‚‹ãŸã‚ã«ã€ä»¥ä¸‹ã®ã‚ˆã†ãªæ©Ÿèƒ½ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

- ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å‡¦ç†
  - ãƒ‡ãƒ¼ã‚¿ã®æ›¸ãè¾¼ã¿ã‚’éåŒæœŸå‡¦ç†åŒ–ã™ã‚‹ã“ã¨ã§ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå¾…ã¤ã“ã¨ãªãã‚¢ãƒ—ãƒªã‚’åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚
- å®šæœŸå®Ÿè¡Œ
  - æ¯æ—¥æ±ºã¾ã£ãŸæ™‚é–“ã«è‡ªå‹•ã§ãƒ‡ãƒ¼ã‚¿ã‚’æ›¸ãè¾¼ã‚€ã‚ˆã†ã«è¨­å®šã™ã‚‹ã€‚
- ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®æ•´ç†
  - åŒã˜ã‚·ãƒ¼ãƒˆã«ä¸Šæ›¸ãã™ã‚‹ã®ã§ã¯ãªãã€æ—¥åˆ¥ãƒ»æœˆåˆ¥ã§æ–°ã—ã„ã‚·ãƒ¼ãƒˆã‚’ä½œæˆã™ã‚‹ã€‚

Google API ã‚’æ´»ç”¨ã™ã‚‹ã“ã¨ã§ã€æ¥­å‹™ã®åŠ¹ç‡åŒ–ã‚„ãƒ‡ãƒ¼ã‚¿ç®¡ç†ã®è‡ªå‹•åŒ–ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

æœ¬è¨˜äº‹ãŒå°‘ã—ã§ã‚‚å‚è€ƒã«ãªã‚Œã°å¹¸ã„ã§ã™ã€‚

ãœã²ã€ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’æ´»ç”¨ã—ã¦ã¿ã¦ãã ã•ã„ï¼

æœ€å¾Œã¾ã§ã”è¦§ã„ãŸã ãã€ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼
